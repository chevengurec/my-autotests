# Ð”Ð•ÐÐ¬ 13: Ð£Ð§Ð˜ÐœÐ¡Ð¯ ÐŸÐžÐÐ˜ÐœÐÐ¢Ð¬ CI/CD
name: CI Learning Pipeline

# Ð ÐÐ—Ð”Ð•Ð› 1: ÐšÐžÐ“Ð”Ð Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ?
on:
  push:
    branches: [ main ]
  workflow_dispatch:

# Ð ÐÐ—Ð”Ð•Ð› 2: Ð§Ð¢Ðž Ð´ÐµÐ»Ð°Ñ‚ÑŒ?
jobs:
  explore-machine:
    runs-on: ubuntu-latest

    steps:
      # Ð¨ÐÐ“ 1: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´ Ñ GitHub
      - name: Step 1 - Get my code
        uses: actions/checkout@v3
        with:
          fetch-depth: 1

      # Ð¨ÐÐ“ 2: ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð³Ð´Ðµ Ð¼Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ÑÑ
      - name: Step 2 - Where am I?
        run: |
          echo "=== Ð˜Ð¡Ð¡Ð›Ð•Ð”Ð£Ð•Ðœ Ð’Ð˜Ð Ð¢Ð£ÐÐ›Ð¬ÐÐ£Ð® ÐœÐÐ¨Ð˜ÐÐ£ ==="
          echo "Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð¿Ð°Ð¿ÐºÐ°:"
          pwd
          echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð¿Ð°Ð¿ÐºÐ¸:"
          ls -la

      # Ð¨ÐÐ“ 3: ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ
      - name: Step 3 - System info
        run: |
          echo "=== Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ Ðž Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ• ==="
          echo "ÐžÐ¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°:"
          uname -a
          echo "Ð’ÐµÑ€ÑÐ¸Ñ Ubuntu:"
          lsb_release -a 2>/dev/null || echo "lsb_release not installed"

      # Ð¨ÐÐ“ 4: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Java Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ
      - name: Step 4 - Install Java
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'

      # Ð¨ÐÐ“ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»Ð¾ÑÑŒ
      - name: Step 5 - Verify installations
        run: |
          echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ˜ ==="
          echo "Java version:"
          java -version
          echo "Java home:"
          echo $JAVA_HOME

      # Ð¨ÐÐ“ 6: ÐŸÐ¾Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
      - name: Step 6 - Environment variables
        run: |
          echo "=== ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð• ÐžÐšÐ Ð£Ð–Ð•ÐÐ˜Ð¯ ==="
          echo "CI environment (ÐµÑÑ‚ÑŒ Ð»Ð¸?): $CI"
          echo "GitHub Actions variables:"
          echo "GITHUB_WORKFLOW: $GITHUB_WORKFLOW"
          echo "GITHUB_RUN_ID: $GITHUB_RUN_ID"

      # Ð¨ÐÐ“ 7: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Java Ñ„Ð°Ð¹Ð» Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ
      - name: Step 7 - Create and run Java
        run: |
          echo "=== Ð¡ÐžÐ—Ð”ÐÐ•Ðœ JAVA ÐŸÐ ÐžÐ“Ð ÐÐœÐœÐ£ ==="
          cat > HelloCI.java << 'EOF'
          public class HelloCI {
              public static void main(String[] args) {
                  System.out.println("ðŸŽ‰ ÐŸÑ€Ð¸Ð²ÐµÑ‚ Ð¸Ð· CI pipeline!");
                  System.out.println("Ð¯ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ GitHub Actions");
          
                  if (System.getenv("CI") != null) {
                      System.out.println("âœ… Ð¯ Ð² CI Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸!");
                  } else {
                      System.out.println("âš ï¸ Ð¯ ÐÐ• Ð² CI Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸");
                  }
              }
          }
          EOF
          
          echo "ÐšÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÐ¼..."
          javac HelloCI.java
          echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼..."
          java HelloCI "ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚_Ð¸Ð·_CI"

      # Ð¨ÐÐ“ 8: Ð¤Ð¸Ð½Ð°Ð» - ÑƒÑÐ¿ÐµÑ… (Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐÐ«Ð™ Ð¡Ð˜ÐÐ¢ÐÐšÐ¡Ð˜Ð¡)
      - name: Step 8 - Success
        run: |
          echo " "
          echo "=================================================="
          echo "ðŸŽŠ ÐŸÐžÐ—Ð”Ð ÐÐ’Ð›Ð¯Ð®! Ð¢Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾:"
          echo "1. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ð» Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð¼Ð°ÑˆÐ¸Ð½Ñƒ Ð² Ð¾Ð±Ð»Ð°ÐºÐµ"
          echo "2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð» Java"
          echo "3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ð» ÑÐ²Ð¾ÑŽ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ"
          echo "4. Ð’ÑÐµ ÑÑ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ð» AUTOMAGICALLY! ðŸª„"
          echo "=================================================="